@model List<greenswamp.Areas.Blog.Models.Post>

@{
    var isFullView = ViewData["IsFullView"] as bool? ?? false;
}

@foreach (var post in Model)
{
    @if (post.Event != null)
    {
    <div class="bg-white shadow-sm p-6 border-l-4 border-l-swamp-400">
        <div class="flex items-start space-x-3">
            <div class="w-10 h-10 bg-swamp-100 rounded-full flex items-center justify-center">
                <svg class="text-swamp-600" fill="currentColor" viewBox="-43.32 -43.32 327.29 327.29" enable-background="new 0 0 240.646 240.646">
                    <g id="SVGRepo_bgCarrier" stroke-width="0"></g>
                    <g id="SVGRepo_tracerCarrier" stroke-linecap="round" stroke-linejoin="round"></g>
                    <g id="SVGRepo_iconCarrier">
                        <g>
                            <path d="m218.787,119.069c-7.552-18.233-23.021-35.615-43.56-48.944-5.611-3.642-11.369-6.826-17.027-9.48 0.001-0.074 0.005-0.148 0.005-0.222 0-15.537-9.405-28.913-22.818-34.749l12.87-12.87c2.929-2.929 2.929-7.678 0-10.606-2.93-2.929-7.678-2.929-10.607,0l-17.237,17.237-17.068-17.068c-2.93-2.929-7.678-2.929-10.607-8.88178e-16-2.929,2.929-2.929,7.678 0,10.606l12.644,12.644c-13.478,5.809-22.94,19.221-22.94,34.805 0,0.074 0.004,0.148 0.005,0.223-5.659,2.654-11.417,5.839-17.029,9.481-20.537,13.329-36.006,30.711-43.558,48.943-8.021,19.364 1.207,41.645 20.573,49.667 4.648,1.925 9.538,2.901 14.534,2.901 6.008-0.001 11.758-1.412 16.9-3.96 9.77,16.056 27.176,26.038 46.456,26.038 19.279,0 36.686-9.981 46.456-26.036 5.142,2.546 10.893,3.958 16.901,3.958 4.996,0 9.886-0.976 14.534-2.901 19.366-8.022 28.595-30.303 20.573-49.667zm-98.464-81.528c10.602,0 19.541,7.25 22.127,17.051-5.886-1.723-11.348-2.661-16.02-2.661l-12.216,.001c-4.672,0-10.133,0.938-16.019,2.661 2.586-9.802 11.526-17.052 22.128-17.052zm21.517,94.241h-43.034l21.518-52.555 21.516,52.555zm-84.875,24.855c-3.016,0-5.974-0.592-8.793-1.759-11.724-4.856-17.311-18.345-12.455-30.068 10.062-24.291 36.026-43.406 57.037-52.348 0.341-0.115 0.672-0.248 0.986-0.407 5.579-2.307 10.785-3.89 15.208-4.632l-28.217,68.921c-0.008,0.018-0.016,0.036-0.022,0.054l-2.468,6.027c-1.387,3.347-3.497,6.227-6.099,8.509-0.101,0.079-0.197,0.162-0.293,0.245-4.069,3.45-9.293,5.457-14.884,5.458zm63.358,22.078c-14.55,0-27.627-7.844-34.513-20.336 2.575-3.007 4.724-6.438 6.3-10.242l.555-1.355h55.316l.566,1.384c1.572,3.794 3.716,7.217 6.287,10.218-6.887,12.489-19.963,20.331-34.511,20.331zm72.152-23.838c-2.819,1.167-5.778,1.759-8.795,1.759-5.617,0-10.865-2.026-14.94-5.502-0.068-0.058-0.136-0.117-0.206-0.172-2.612-2.281-4.73-5.162-6.117-8.51l-2.477-6.049c-0.009-0.022-0.018-0.044-0.027-0.066l-28.218-68.923c4.429,0.74 9.648,2.328 15.245,4.645 0.289,0.145 0.593,0.266 0.904,0.373 21.006,8.931 47.013,28.06 57.085,52.377 4.856,11.724-0.731,25.212-12.454,30.068z"></path>
                            <path d="m175.408,183.757c-2.93-2.929-7.678-2.929-10.607,0-2.929,2.929-2.929,7.678 0,10.606l16.592,16.592c1.465,1.464 3.385,2.197 5.304,2.197 1.919,0 3.839-0.732 5.304-2.197 2.929-2.929 2.929-7.678 0-10.606l-16.593-16.592z"></path>
                            <path d="m120.323,202.182c-4.143,0-7.5,3.358-7.5,7.5v23.464c0,4.142 3.357,7.5 7.5,7.5s7.5-3.358 7.5-7.5v-23.464c0-4.142-3.357-7.5-7.5-7.5z"></path>
                            <path d="m65.239,183.758l-16.591,16.591c-2.929,2.929-2.929,7.678 0,10.606 1.465,1.464 3.385,2.197 5.304,2.197 1.919,0 3.839-0.732 5.304-2.197l16.591-16.591c2.929-2.929 2.929-7.678 0-10.606-2.93-2.929-7.678-2.929-10.608,0z"></path>
                        </g>
                    </g>
                </svg>
            </div>
            <div class="flex-1">
                        <h4 class="font-semibold text-swamp-900">@post.Content</h4>
                <p class="mt-2 text-swamp-700">
                        @post.Event.EventTime.ToString("MMM dd, yyyy h:mm tt") - @post.Event.Location
                    <span class="block text-sm mt-1 text-swamp-500">Hosted by @post.Event.HostOrg</span>
                </p>
                <div class="mt-4 flex items-center space-x-4">
                    <button class="bg-swamp-500 text-white px-4 py-2 rounded-full text-sm hover:bg-swamp-600">
                        RSVP (@post.Event.RsvpCount going)
                    </button>
                    <button class="text-swamp-600 hover:text-swamp-800 text-sm">
                        Add to Calendar
                    </button>
                </div>
            </div>
        </div>
    </div>
    }
    else
    {
    <div class="bg-white shadow-sm p-6">
        <div class="flex items-start space-x-3">
                <a href="@Url.Action("Index", "Profile", new { username = post.User.Username })" >
                @if (!string.IsNullOrEmpty(post.User.AvatarUrl))
                {
                    <img src="@post.User.AvatarUrl" alt="User avatar" class="w-16 h-16 rounded-full" />
                }
                else
                {
                    <img src="https://i.pravatar.cc/150?img=6" alt="Default avatar" class="w-16 h-16 rounded-full" />
                }
                </a>
            <div class="flex-1">
                <div class="flex items-center space-x-2">
                    <a href="@Url.Action("Index", "Profile", new { username = post.User.Username })" >
                    <h4 class="font-semibold text-swamp-900">@post.User.DisplayName</h4>
                    </a>
                    <a href="@Url.Action("Index", "Profile", new { username = post.User.Username })" class="text-sm text-swamp-500 hover:text-swamp-700">@@@post.User.Username</a>
                    <span class="text-swamp-500">·</span>
                    <a href="@Url.Action("Index", "Post", new { postId = post.PostId })" class="text-sm text-swamp-500 hover:text-swamp-700">@post.CreatedAt.ToString("MMM dd, yyyy")</a>
                </div>
                <p class="mt-2 text-swamp-700">
                    @post.Content
                    @foreach (var tag in post.Tags)
                    {
                        <span class="text-swamp-700 hover:text-swamp-500">#@tag.TagName</span>
                    }
                </p>
                @if (!string.IsNullOrEmpty(post.MediaUrl))
                {
                    @if (post.MediaType == greenswamp.Areas.Blog.Models.MediaType.Image)
                    {
                        <img class="mt-2 p-1 rounded-xl" src="@post.MediaUrl" alt="@post.AltText" />
                    }
                        else if (post.MediaType == greenswamp.Areas.Blog.Models.MediaType.Video)
                    {
                        <div class="mt-4 rounded-lg overflow-hidden">
                            <video class="w-full aspect-video object-cover bg-slate-900" controls preload="metadata" title="@post.AltText">
                                <source src="@post.MediaUrl" type="video/mp4">
                            </video>
                        </div>
                    }
                }
                <div class="mt-4 flex items-center space-x-6 text-swamp-500">
                    <a href="@Url.Action("Index", "Post", new { postId = post.PostId })">
                    <button class="flex items-center space-x-2 hover:text-swamp-600">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"/>
                        </svg>
                        <span>@post.Interactions.Count(i => i.InteractionType == greenswamp.Areas.Blog.Models.InteractionType.Comment) Answers</span>
                    </button>
                    </a>
                    <button class="flex items-center space-x-2 hover:text-swamp-600">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"></path>
                        </svg>
                        <span>@post.Interactions.Count(i => i.InteractionType == greenswamp.Areas.Blog.Models.InteractionType.Reribb) Reribbs</span>
                    </button>
                </div>
            </div>
        </div>
    </div>
    }
    @if (isFullView)
    {
       <div class="p-4">
            <h5 class="font-semibold text-swamp-900 mb-4">Comments:</h5>
            @foreach (var interaction in post.Interactions.Where(i => i.InteractionType == greenswamp.Areas.Blog.Models.InteractionType.Comment))
            {
                <div class="flex items-start space-x-3 mb-4">
                    <a href="@Url.Action("Index", "Post", new { postId = post.PostId })">
                    @if (!string.IsNullOrEmpty(interaction.User.AvatarUrl))
                    {
                        <img src="@interaction.User.AvatarUrl" alt="User avatar" class="w-12 h-12 rounded-full" />
                    }
                    else
                    {
                        <img src="https://i.pravatar.cc/150?img=6" alt="Default avatar" class="w-12 h-12 rounded-full" />
                    }
                    </a>
                    <div class="flex-1">
                        <div class="flex items-center space-x-2">
                            <h6 class="font-semibold text-swamp-900">@interaction.User.DisplayName</h6>
                            <a href="@Url.Action("Index", "Profile", new { username = interaction.User.Username })" class="text-sm text-swamp-500 hover:text-swamp-700">@interaction.User.Username</a>
                            <span class="text-swamp-500">·</span>
                            <span class="text-sm text-swamp-500">@interaction.CreatedAt.ToString("MMM dd, yyyy")</span>
                        </div>
                        <p class="mt-2 text-swamp-700">@interaction.Content</p>
                    </div>
                </div>
            }
        </div>
    }
}